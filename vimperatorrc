" ==================== basic options ==================== "
set activate=quickmark,paste
set complete=sl
set focuscontent
set followhints=1
set guioptions=Bmrb
set hintinputs+=name
set hlsearch
set showstatuslinks=2
set wildoptions=auto

set nextpattern+='次','\bolder\b'
set previouspattern+='前','\bnerwer\b'

" set jsdebugger

let mapleader=","

" ==================== Firefox options ==================== "
" disable accesskey
set! ui.key.generalAccessKey=0
" hide close button
set! browser.tabs.closeButtons=2
" open bookmarks in background
set! browser.tabs.loadBookmarksInBackground=true
" open tabs by javascript in background
set! browser.tabs.loadDivertedInBackground=true
" allow lots of popups for ldr
set! dom.popup_maximum=1000
" allow control sidebar position
" set! layout.scrollbar.side=1
" show tab preview
set! browser.allTabs.previews=true
set! browser.ctrlTab.previews=true
" change new tab position
set! browser.tabs.insertRelatedAfterCurrent=false
" change behaviour on open folder
set! browser.tabs.loadFolderAndReplace=false
" use mousewheel acceleration
set! mousewheel.acceleration.factor=5
set! mousewheel.acceleration.start=3


" ==================== key mappings ==================== "
" increase j, k, h, l
nnoremap j 5j
nnoremap k 5k
nnoremap h 3h
nnoremap l 3l

" Use beginning matches on command-line history
cnoremap <C-p> <Up>
cnoremap <C-n> <Down>

" avoid unintended paste
" only use "gP"
nnoremap p <Nop>
nnoremap P <Nop>

" disable highlight
nnoremap <silent> gh :nohl<CR>:offwordhighlight<CR>

" toggle "ナビゲーションバー"
nnoremap <silent> I :toolbartoggle ナビゲーションツールバー<CR>

" toggle autopagerize
nnoremap <silent> a :toggleautopagerize<CR>

" dispatch mouse event
js <<EOM
(function() {
function dispatchMouseClickByXPath(xpath) {
    let elements = util.evaluateXPath(xpath);
    if(elements.snapshotLength) {
        buffer.followLink(elements.snapshotItem(0));
    }
    else {
        liberator.echomsg("not found: " + xpath);
    }
}

commands.addUserCommand(["toggleautopagerize"],
    "toggle on/off autopagerize",
    function(args)
    {
        dispatchMouseClickByXPath('id("autopagerize_help")//a[@class="autopagerize_link"]');
    });

commands.addUserCommand(["offwordhighlight"],
    "off wordhighlight",
    function(args)
    {
        dispatchMouseClickByXPath('id("wordhighlight_words")//*[@value="off"]');
    });
})();
EOM


" ==================== plugin options ==================== "
" migemo hint
set hintmatching=custom
js <<EOM
liberator.plugins.customHintMatcher = function(inputString){
    let r = migemo.getRegExp(inputString);
    return function(hintString) r.test(hintString);
};
EOM

" commandBookmarklet
let command_bookmarklet_prefix=""

" sbmincsearch
let sbmincsearch_service_name = "delicious"
let sbmincsearch_max = 15
runtime! plugin/sbm_incsearch.js
set complete=stIl

" colorize_url
runtime! plugin/colorize_url.js
hi ColorizeUrlSubdomain color: #333;
hi ColorizeUrlPort      color: #333;
hi ColorizeUrlFragment  color: #333;

" feedSomeKeys
runtime! plugin/feedSomeKeys_2.js
autocmd LocationChange .* fmapc
autocmd LocationChange 'reader\.livedoor\.com/reader' fmap! s a r c j k f,j F,k <Space> <S-Space> z b p o v > J < K
autocmd LocationChange 'fastladder\.com/reader'       fmap! s a r c j k f,j F,k <Space> <S-Space> z b p o v > J < K
autocmd LocationChange 'mail\.google\.com/mail/#'     fmap! u k j o <CR> p n c ? x s y e m ! #
autocmd LocationChange 'www\.tumblr\.com/dashboard'   fmap! -vkey -event keydown j k

" arpeggio
" runtime! plugin/arpeggio.js
js <<EOF
/*
liberator.plugins.arpeggioMap(modes.NORMAL, true, "asd", function() {
    alert("asd");
});
*/
EOF

" ==================== colorscheme ==================== "
colorscheme mac

" force disable ime in commandline
style -name commandline-ime chrome://* #liberator-commandline-command input { ime-mode: inactive; }


" ==================== others ==================== "
" load local file
source! ~/.vimperatorrc.local
